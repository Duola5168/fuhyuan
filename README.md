
# 富元機電 - 工作服務單應用程式 (V1.7)

這是一個現代、高效的網頁應用程式，旨在數位化並簡化建立、管理及分享工作服務單的流程。它特別為需要在現場工作的服務人員設計，提供了一個從資料填寫到客戶簽名、再到 PDF 報告產出的一站式解決方案。

## ✨ V1.7 重大更新：全自動 Dropbox 無縫認證

*   **🔑 內建設定小幫手**：新增一個簡單易用的設定頁面，引導管理員透過點擊按鈕和複製貼上，輕鬆完成 Dropbox 授權並取得 `Refresh Token`，徹底告別複雜的指令列操作。
*   **🚀 穩定無縫的上傳體驗**：服務人員點擊上傳後，檔案將**直接、自動地**歸檔至公司指定的 Dropbox 資料夾，全程無需與 Dropbox 互動。
*   **🔒 更可靠的認證機制**：重構認證流程，應用程式在背景使用 Refresh Token 安全地換取存取權杖，大幅提升穩定性與安全性。
*   **📄 全新設定教學**：`README.md` 文件已完全重寫，提供使用全新「設定小幫手」的完整指南。

---

## 🛠️ Dropbox 整合設定 - 一次性設定教學

為了讓應用程式能夠**自動、安全地**連接到您公司指定的 Dropbox 帳戶，請依照以下步驟進行**一次性**設定。

### 步驟 1：在 Dropbox 建立應用程式

1.  前往 [Dropbox App Console](https://www.dropbox.com/developers/apps)。
2.  點擊 **"Create app"** 按鈕。
3.  選擇 **"Scoped access"**。
4.  在 "Choose the type of access you need" 下，選擇 **"App folder"** – 這會將應用程式的存取權限限制在一個專屬的資料夾內，最為安全。
5.  為您的應用程式命名，例如 `富元工作服務單上傳工具`，然後點擊 **"Create app"**。

### 步驟 2：設定應用程式權限與重新導向 URI

1.  建立後，您會被導向應用程式的管理頁面。
2.  切換到 **"Permissions"** 分頁。
3.  在權限列表中，找到並勾選以下權限：
    *   `files.content.write`：允許應用程式上傳檔案。
4.  點擊右下角的 **"Submit"** 按鈕儲存變更。
5.  切換到 **"Settings"** 分頁。
6.  在同一個頁面，複製您的 **"App key"** 和 **"App secret"**。請將它們暫時保存在一個記事本中，下一步會用到。
7.  找到 **"OAuth 2"** 區塊下的 **"Redirect URIs"** 欄位。
8.  **非常重要**：在這裡**新增您部署後的應用程式網址**。例如，如果您的 Netlify 網址是 `https://fuyuan-work-order.netlify.app`，您就必須在這裡輸入 `https://fuyuan-work-order.netlify.app/` (請注意結尾的斜線)。點擊 **"Add"**。
    *   如果您在本機測試，可以新增 `http://localhost:5173/` (或您 vite 使用的埠號)。

### 步驟 3：使用內建小幫手產生 Refresh Token (新！)

現在，我們將使用應用程式內建的工具來取代過去複雜的指令。

1.  **開啟設定小幫手**：
    *   在瀏覽器中，打開您部署好的應用程式。
    *   在網址的最後面加上 `#setup-dropbox`，然後按下 Enter。
    *   **範例網址**：`https://fuyuan-work-order.netlify.app/#setup-dropbox`

2.  **輸入 App 資訊**：
    *   在設定小幫手頁面中，將您在步驟 2 複製的 **App key** 和 **App secret** 貼到對應的輸入框中。

3.  **完成授權**：
    *   點擊「前往 Dropbox 授權」按鈕。
    *   您會被重新導向至 Dropbox 網站。請登入您**公司用來存放服務單的那個 Dropbox 帳號**，並點擊 "允許"。
    *   授權後，您會自動返回應用程式頁面。

4.  **取得 Refresh Token**：
    *   返回頁面後，小幫手會自動完成所有操作，並在畫面上顯示一個綠色的成功區塊。
    *   **複製 `refresh_token` 的值**。這就是我們需要的長期更新權杖。請妥善保管它。

### 步驟 4：在 Netlify 中設定環境變數

這是最後一步！

1.  登入您的 Netlify 帳戶，並進入您的專案。
2.  前往 **"Site settings"** > **"Build & deploy"** > **"Environment"**。
3.  點擊 **"Edit variables"**，並新增以下**三個**變數：
    *   `DROPBOX_APP_KEY`: 貼上您複製的 **App key**。
    *   `DROPBOX_APP_SECRET`: 貼上您複製的 **App secret**。
    *   `DROPBOX_REFRESH_TOKEN`: 貼上您在步驟 3 透過小幫手取得的**長期 Refresh Token**。

完成以上步驟後，您的應用程式就設定完成了！現在所有上傳操作都將在背景自動進行。

---

## ✨ 功能亮點

*   **✨ AI 智慧建議**：整合 Google Gemini AI，可根據「處理事項」和「產品項目」自動產生專業的「處理情形」報告內容，大幅提升填寫效率。
*   **📄 直覺的表單介面**：清晰易用的表單，包含所有必要欄位。
*   **✍️ 數位簽名**：服務人員與客戶可以直接在裝置螢幕上簽名。
*   **📸 現場照片上傳**：可直接使用裝置相機拍照或從相簿上傳多張現場照片。
*   **💾 本機暫存系統**：可將未完成的服務單儲存為多個本地暫存檔。
*   **☁️ 雲端儲存與同步**：
    *   **Dropbox**：採用 Refresh Token 機制，可將 PDF 服務單**安全、自動、無縫地**上傳歸檔，使用者無需進行任何登入操作。
    *   **Google Drive**：可將暫存檔安全地匯出/匯入至您的 Google 雲端硬碟。
*   **🚀 即時 PDF 產生與分享**：一鍵產生專業、排版精美的 PDF 服務單報告。
*   **🔒 安全第一**：所有 API 金鑰等敏感資訊採用業界標準的環境變數進行管理，授權流程安全可靠。
*   **📱 跨裝置相容**：採用響應式設計，在手機、平板和桌上型電腦上都能提供良好的操作體驗。
